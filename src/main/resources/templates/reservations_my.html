<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout :: head('My Reservations - StudyRooms')}"></head>

<body th:replace="~{layout :: body('my-reservations', ~{::content})}">
<div th:fragment="content">

    <div class="d-flex justify-content-between align-items-center mb-2">
        <h2 class="mb-0">My Reservations</h2>
        <a th:href="@{/reservations/new}" class="btn btn-primary">
            + New Reservation
        </a>
    </div>

    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <p class="text-muted mb-4">
        Maximum duration per reservation: <strong>2 hours</strong>.
        Maximum number of active reservations per day: <strong>3</strong>.
        Consecutive reservations are <strong>allowed</strong> (e.g., 10:00–12:00 and 12:00–14:00).
    </p>

    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-light">
            <tr>
                <th>Space</th>
                <th>Date</th>
                <th>Time</th>
                <th>Status</th>
                <th style="width: 140px;">Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="r : ${reservations}">
                <td th:text="${r.studySpace.name}">Room A</td>
                <td th:text="${r.date}">2025-01-01</td>
                <td>
                    <span th:text="${r.startTime}">10:00</span>
                    -
                    <span th:text="${r.endTime}">12:00</span>
                </td>
                <td>
                    <span class="badge"
                          th:classappend="${r.status} == 'CONFIRMED' ? ' bg-success' :
                                          (${r.status} == 'PENDING' ? ' bg-warning text-dark' :
                                           (${r.status} == 'CANCELLED' ? ' bg-secondary' :
                                            (${r.status} == 'CANCELLED_BY_STAFF' ? ' bg-danger' : ' bg-light text-dark')))"
                          th:text="${r.status}">
                        CONFIRMED
                    </span>
                </td>
                <td>
                    <!-- ο φοιτητής δεν μπορεί να ακυρώσει αν είναι ήδη CANCELLED ή CANCELLED_BY_STAFF -->
                    <form th:if="${r.status != T(gr.hua.dit.studyrooms.entity.ReservationStatus).CANCELLED
          and r.status != T(gr.hua.dit.studyrooms.entity.ReservationStatus).CANCELLED_BY_STAFF}"
                          th:action="@{/reservations/{id}/cancel(id=${r.id})}"
                          method="post"
                          class="d-inline">
                                <input type="hidden"
                                       th:if="${_csrf != null}"
                                       th:name="${_csrf.parameterName}"
                                       th:value="${_csrf.token}"/>
                        <button type="submit" class="btn btn-sm btn-danger"
                                onclick="return confirm('Cancel this reservation?');">
                            Cancel
                        </button>
                    </form>
                </td>
            </tr>

            <tr th:if="${#lists.isEmpty(reservations)}">
                <td colspan="5" class="text-center text-muted">
                    You have no reservations yet.
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <div th:if="${penaltyUntil}" class="alert alert-danger">
        You are blocked from making new reservations until
        <span th:text="${penaltyUntil}"></span>.
    </div>

    <a th:href="@{/dashboard}" class="btn btn-secondary mt-3">
        Back to Dashboard
    </a>

</div>
</body>
</html>
